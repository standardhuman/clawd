<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Brian's Dashboard</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
</head>
<body>
  <!-- Password Gate -->
  <div id="auth-gate" style="display:flex; align-items:center; justify-content:center; height:100vh; background:#1e1e2e;">
    <form id="auth-form" style="text-align:center;" onsubmit="return checkAuth()">
      <div style="font-size:2rem; margin-bottom:1rem;">ğŸª¨</div>
      <input type="password" id="auth-input" placeholder="Enter passphrase" autocomplete="off" autofocus
        style="padding:12px 20px; border-radius:8px; border:1px solid #45475a; background:#313244; color:#cdd6f4; font-size:1rem; width:250px; text-align:center; outline:none;">
      <div id="auth-error" style="color:#f38ba8; margin-top:8px; font-size:0.85rem; display:none;">Nope.</div>
    </form>
  </div>
  <script>
    function checkAuth() {
      var hash = 0, s = document.getElementById('auth-input').value;
      for (var i = 0; i < s.length; i++) { hash = ((hash << 5) - hash) + s.charCodeAt(i); hash |= 0; }
      if (hash === -982936170) {
        localStorage.setItem('dashboard-auth', Date.now().toString());
        document.getElementById('auth-gate').style.display = 'none';
        document.getElementById('main-dashboard').style.display = 'block';
        return false;
      }
      document.getElementById('auth-error').style.display = 'block';
      return false;
    }
    var authTime = parseInt(localStorage.getItem('dashboard-auth') || '0');
    var sevenDays = 7 * 24 * 60 * 60 * 1000;
    if (authTime && (Date.now() - authTime) < sevenDays) {
      document.getElementById('auth-gate').style.display = 'none';
    } else {
      localStorage.removeItem('dashboard-auth');
      document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('main-dashboard').style.display = 'none';
      });
    }
  </script>
  <div id="main-dashboard" class="dashboard">
    <!-- Tab Bar -->
    <nav class="view-tabs">
      <button class="view-tab active" id="tab-dashboard" onclick="switchView('dashboard')">ğŸ“Š Dashboard</button>
      <button class="view-tab" id="tab-mc" onclick="switchView('mc')">ğŸ® Mission Control</button>
    </nav>

    <!-- Mission Control iframe (hidden by default) -->
    <div id="mc-view" style="display:none; width:100%; height:calc(100vh - 52px); margin:0; padding:0;">
      <iframe id="mc-iframe" style="width:100%; height:100%; border:none; background:#1e1e2e;" loading="lazy"></iframe>
    </div>

    <!-- Dashboard View -->
    <div id="dashboard-view">
    <!-- Header -->
    <header class="header">
      <h1>âš¡ Brian's Dashboard</h1>
      <div class="header-meta">
        <span id="last-updated"></span>
        <span class="live-time" id="live-time"></span>
      </div>
    </header>

    <!-- Needs Attention -->
    <div class="section-title">ğŸ”´ Needs Attention</div>
    <div id="attention-grid" class="attention-grid"></div>

    <!-- Sprint Progress -->
    <div class="section-title">ğŸ“± SailorSkills Pro â€” Sprint Progress</div>
    <div id="sprint-section" class="sprint-section card"></div>

    <!-- Projects -->
    <div class="section-title">ğŸ“¦ Active Projects</div>
    <div id="project-grid" class="project-grid"></div>

    <!-- To-Do Section -->
    <div class="section-title">âœ… To-Do</div>
    <div id="todo-section" class="todo-section"></div>

    <!-- Bottom: Chart + Activity + Deadlines -->
    <div class="section-title" style="margin-bottom: 0;"></div>
    <div class="bottom-grid" style="margin-top: 14px;">
      <div>
        <div class="section-title" style="margin-top: 0;">â° Time Allocation</div>
        <div class="chart-container">
          <canvas id="time-chart"></canvas>
        </div>
        <div id="time-detail-panel" class="time-detail-panel"></div>
      </div>
      <div>
        <div class="section-title" style="margin-top: 0;">ğŸ“‹ Recent Activity</div>
        <div id="activity-list" class="activity-list"></div>
      </div>
      <div>
        <div class="section-title" style="margin-top: 0;">ğŸ¯ Deadlines</div>
        <div id="deadlines-list" class="deadlines-list"></div>
      </div>
    </div>

    <!-- Agents Footer -->
    <div id="agents-bar" class="agents-bar"></div>
  </div> <!-- end dashboard-view -->
  </div> <!-- end main-dashboard -->

  <script>
    function switchView(view) {
      var dashView = document.getElementById('dashboard-view');
      var mcView = document.getElementById('mc-view');
      var tabDash = document.getElementById('tab-dashboard');
      var tabMc = document.getElementById('tab-mc');
      if (view === 'mc') {
        dashView.style.display = 'none';
        mcView.style.display = 'block';
        tabDash.classList.remove('active');
        tabMc.classList.add('active');
        // Load iframe on first switch â€” try local first, fall back to deployed
        var iframe = document.getElementById('mc-iframe');
        if (!iframe.src || iframe.src === 'about:blank' || !iframe.src.includes('mission-control')) {
          iframe.src = 'https://mission-control.briancline.co?auth=embed';
        }
      } else {
        dashView.style.display = 'block';
        mcView.style.display = 'none';
        tabDash.classList.add('active');
        tabMc.classList.remove('active');
      }
      // Remember preference
      localStorage.setItem('dashboard-view', view);
    }
    // Restore last view on load
    document.addEventListener('DOMContentLoaded', function() {
      var lastView = localStorage.getItem('dashboard-view');
      if (lastView === 'mc') switchView('mc');
    });
  </script>
  <script src="app.js"></script>
</body>
</html>

# 2026-02-03 Session Notes

## Notion Conditions Database Navigation (IMPORTANT)

**Full path to get growth/anode data:**
```
Client List → Boat Page → Service Log (child_page) → synced_block → Conditions (child_database)
```

**API traversal:**
1. Query Client List database for boat → get `page.id`
2. `GET /blocks/{boatPageId}/children` → find `child_page` with title containing "Service Log"
3. `GET /blocks/{serviceLogId}/children` → find `synced_block`
4. `GET /blocks/{syncedBlockId}/children` → find `child_database` with title containing "Conditions"
5. Query that Conditions database for date range

**Conditions database fields:**
- Date (date)
- Growth (multi-select): Minimal, Moderate, Heavy, Severe
- Anodes (multi-select): Good, Replaced
- Installed (number)
- Notes (rich_text) — contains anode type details like "Replaced one 1-inch shaft anode"

**Growth surcharge mapping:**
- Minimal, Min→Mod, Moderate: 0%
- Min→Heavy: 25%
- Mod→Heavy: 37.5%
- Heavy: 50%
- Heavy→Severe: 75%
- Severe: 100%

**Notion search limitation:** Search API only indexes ~61 of ~100+ Conditions databases. Must traverse from boat page to reliably find them.

## Billing System Complete

Built end-to-end billing automation for SailorSkills:

### Stripe Setup
- CLI connected via `stripe login`
- Created restricted key "Howard Billing Automation Key" with Customers, Invoices, Charges (Write)
- Test invoice sent to Brian ($248) — charged and receipt received
- Key stored in 1Password

### Notion Integration
- Howard token: `ntn_4943...7091` (full token in 1Password)
- Saved to `~/AI/business/sailorskills-platform/.env` as `NOTION_HOWARD_TOKEN`
- Client List database: `0ae0e330-780b-4764-956e-12e8ee344ea2`
- Important: Boat name field is "Boat" not "Name"

### January 2026 Billing Corrections
- Halo anode: Changed from $46.46 (DF-80) to $28.37 (Beneteau 30mm prop)
- The Circus Police: Changed from recurring to one-time rate ($284.14 → $303.25)
- Final total: $9,873.89 (52 boats, 9 anodes)

### Deliverables
1. **CLI Script**: `~/clawd/scripts/billing/sailorskills-invoice.sh`
   - Incremental or batch billing
   - Interactive mode
   - Tracks billed boats

2. **Web Dashboard**: `~/clawd/billing-dashboard/`
   - React + Tailwind + Express
   - Preview invoices before sending
   - Batch operations
   - Start: `npm run dev`

### Mac Mini Issue
- Brian lost remote access (Screens 5 + SSH both down)
- Suspected: Tailscale killed inadvertently
- Solution: Physical power cycle
- After recovery: `sudo systemsetup -setrestartpowerfailure on`
- Future: Add smart plug for remote power cycling

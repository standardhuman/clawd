# 2026-02-02 - Monday

## Billing Automation Project

**Goal:** Automate monthly billing for SailorSkills hull cleaning services.

### Workflow (current manual process):
1. Open Notion → check each boat's Conditions database for recent service
2. Go to Stripe → create charge based on boat type, length, growth level, anodes replaced
3. If payment method on file → charge + send receipt
4. If no payment method → send invoice

### What We Mapped:
- **Notion structure:** Client List → {Boat} Service Log (child page) → {Boat} Conditions (database)
- **Conditions fields:** Date, Growth (multi-select), Anodes (multi-select), Installed (number), Notes
- **Pricing in Supabase:** business_pricing_config table has growth surcharges (Heavy=50%, Severe=100%), anode markup (50% + $15 labor)
- **Anodes catalog:** anodes_catalog table has ~1000+ anodes with list_price and sale_price

### Issue Found:
- Notion search API only returns 61 of ~100+ Conditions databases
- Deeply nested databases (inside Service Log pages) aren't indexed by search
- Need to crawl boat pages directly to find all Conditions databases

### January 2026 Services Found (28 of ~55):
- 5 with anode replacements (The Circus Police, Halo, Innamorata, Phoenix, Omega)
- 13 with heavy growth surcharge candidates
- 3 powerboats (extra 25% surcharge)

### Completed This Session:

**Growth Surcharge Logic (Graduated):**
- Brian clarified: don't just use max growth level
- Use the RANGE to determine surcharge:
  - Min→Heavy = 25% (not 50%)
  - Mod→Heavy = 37.5%
  - Heavy only = 50%
  - Heavy→Severe = 75%
- This is fairer for boats with mixed conditions

**Anode Pricing:**
- Found working Supabase API key in `sailorskills-inventory/.env`
- Formula: (cost × 1.5) + $15 labor per anode
- Key anodes mapped:
  - 1" shaft (Camp X-3): $11.28 cost → $31.92 charge
  - DP-612H hull (Heavy): $85.36 cost → $143.04 charge
  - Prop anode (DF-80): $20.97 cost → $46.46 charge
  - ZHC-4: $22.98 cost → $49.47 charge

**January 2026 Billing Complete:**
- 52 services: $9,125.47
- 9 anodes installed: $444.86
- **Total: $9,570.33**

**Stripe Invoice Design:**
- Use Stripe Invoices (not simple charges)
- Custom fields: Vessel name, Service Date
- Line items: Hull Cleaning (bundled), Anodes (separate)
- Detailed breakdown in memo field
- Auto-charge if card on file, send invoice if not

**Test Data Created:**
- "Test Vessel - Howard" in Notion Client List
- Email: standardhuman@gmail.com
- 35ft Sail, 1 prop, Berkeley Marina, Recurring

**Documentation:**
- Created `~/Obsidian/SailorSkills/Billing System.md` — full billing reference
- Updated `January 2026 Billing.md` with final numbers

### Next Steps:
- [ ] Stripe CLI login
- [ ] Run test invoice for Test Vessel - Howard
- [ ] Build Notion crawler for all Conditions databases
- [ ] Create invoice generation script

## Technical Notes

- Notion API has control character issues - use `tr -d '\000-\037'` to clean responses
- Supabase URL: `fzygakldvvzxmahkdylq.supabase.co`
- Supabase API keys in `~/AI/business/sailorskills-platform/sailorskills-inventory/.env`
- Notion API version: `2022-06-28` (not 2025)

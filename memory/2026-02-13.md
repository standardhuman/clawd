# 2026-02-13

## Infrastructure Optimization Session

### Local Embeddings
- Switched `memorySearch.provider` from `openai` to `local`
- Uses `node-llama-cpp` with `embeddinggemma-300M-Q8_0.gguf` (~313MB, auto-downloaded)
- Runs on Metal (Apple Silicon GPU acceleration) â€” native binaries already built
- Eliminates OpenAI API dependency for semantic search
- Set `fallback: "none"` â€” fully local, no remote fallback

### Heartbeats Disabled
- HEARTBEAT.md was empty (comments only) â€” heartbeats were wasting API calls
- Set `heartbeat.every: "0"` to disable
- Was ~21% of Howard's API calls (~$113/month at API rates)
- Also reduces automation fingerprint for TOS risk

### Usage Audit (Jan 25 - Feb 13, ~20 days)
- **Howard: $545** (9,742 API calls, ~2,022 heartbeat)
- **Jacques: $377** (8,164 calls)
- **Marcel: $151** (5,155 calls)
- **Total: $1,073** at API rates ($5/$25 per MTok Opus 4.6)
- Projected monthly: ~$1,600
- Cache reads = 49% of cost (system prompt re-sent every call)
- Cache writes = 41% (new context entering cache)
- Output = 10% (actual responses)
- Total tokens: ~1.16 billion (but 1.09B were cache reads)

### Kimi K2.5 via NVIDIA (Free)
- Got API key from 1Password (`nvapi-...`)
- Configured as `nvidia` provider with `openai-completions` API
- Model: `nvidia/moonshotai/kimi-k2.5`, alias: `kimi`
- Free tier: 1,000 requests/day, 200K context
- **Slow** (~60s for simple response in testing)
- Text only (no image input)
- Switchable: `/model kimi` and `/model opus`
- Kept Opus as default â€” Kimi is available as cost-saving option

### TOS Concern â€” Ajit Got Banned
- Ajit received: "This credential is only authorized for use with Claude Code"
- Same OAuth token type as Brian's â€” same risk
- Soft ban: blocks direct API calls but likely leaves Claude Code CLI working
- Strategy: keep running until/unless banned, build escape hatch (claude-telegram-bridge)
- Reducing API footprint helps (heartbeats off, local embeddings)

### Architecture Explained
- OpenClaw is NOT Claude Code â€” it calls Anthropic Messages API directly
- Gateway (Node.js on Mac mini) â†’ assembles prompt (no AI) â†’ sends to Anthropic API â†’ Opus processes â†’ tool calls executed locally â†’ response to Telegram
- "Claude Code" in system prompt is persona/toolset identity, not the CLI binary

### Reddit Guide Takeaways
- Key insight: model diversity ($60/month vs our $1,600)
- Use Opus for setup/complex, Kimi for daily, Haiku for heartbeats
- /compact before new task discussions
- Sub-agents for cron jobs (cheaper models, better reliability)
- Supermemory.ai for memory backup (free)

### DeepSeek V3.2 Added
- API key from 1Password (`sk-262098...`)
- Provider: `deepseek`, aliases: `deepseek` and `deepseek-r`
- Pricing: $0.28/$0.42 per MTok (cache hit: $0.028) â€” 95% cheaper than Opus
- 128K context, tool calls supported
- **Needs balance top-up** â€” returned "Insufficient Balance" on test
- Top up at platform.deepseek.com ($5-10 is plenty)

### OpenAI Codex OAuth â€” Parked
- Requires interactive TTY + provider plugin not found in current install
- Version mismatch: CLI updated to 2026.2.12, gateway on 2026.2.3-1, homebrew install at 2026.1.29
- Same TOS gray area as Anthropic OAuth â€” not urgent
- Brian has ChatGPT Plus subscription â€” could enable later
- Command would be: `openclaw models auth login --provider openai-codex`

### Alex Finn YouTube Guide (lxfakTpdz1Y)
- Confirms our model diversity strategy is correct
- His recommendations: Opus (brain) â†’ Kimi K2.5 (budget brain), Haiku (heartbeat), Codex 5.2 (coding), DeepSeek V3 (web browsing), Gemini Flash (image understanding)
- His Opus cost estimate: ~$1K/month â€” matches our audit
- New idea: per-task model routing via sub-agents (tell Howard to spawn coding tasks on DeepSeek, browsing on DeepSeek, etc.)
- MiniMax 2.1 mentioned as cheap coding alternative
- Local models on Mac hardware for free tokens (Ollama)
- He runs Kimi K2.5 locally on Mac Studios

### Version Mismatch Issue
- Gateway runs from `/opt/homebrew/lib/node_modules/openclaw/` (Homebrew)
- `npm install -g` went to fnm-managed node at different path
- Need to align versions â€” gateway restart required
- Current: CLI 2026.1.29 (homebrew) / 2026.2.12 (fnm), Gateway 2026.2.3-1

### Cost Reduction Roadmap
1. âœ… Heartbeats disabled (~$113/month saved)
2. âœ… Kimi available as free alternative
3. ðŸ”„ Consider Sonnet 4.5 ($3/$15) as middle tier (needs separate API key)
4. ðŸ”„ Jacques/Marcel could use Kimi or Sonnet
5. ðŸ”„ Trim system prompt (AGENTS.md is large â€” cache reads are 49% of cost)
6. Target: $500-750/month on API, or much less with Kimi heavy usage
